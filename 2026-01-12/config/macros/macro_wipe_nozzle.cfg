[gcode_macro WIPE_NOZZLE]
variable_target_extruder: 0
gcode:
  {% set x_wait = printer.toolhead.axis_maximum.x|float /2 %}
  {% set y_wait = printer.toolhead.axis_maximum.y|float - 20 %}  
  {% set wipe_count = 10 %}
  
  SET_DISPLAY_TEXT MSG="Nozzle cleaning"                                                      # Displays info
    STATUS_CLEANING  

  SAVE_GCODE_STATE NAME=wipe_nozzle_state
  G0 Z15 X285 Y300 F12000
  M106 S255
  M109 S{target_extruder}
  G4 P10000
  G90
  G0 Z1 F3000
  {% for wipe in range(wipe_count) %}
    {% for coordinate in [(200, 300),(250, 296), (265, 300)] %}
      G0 X{coordinate[0]} Y{coordinate[1] + 0.0 * wipe} Z1 F12000
    {% endfor %}
  {% endfor %}
  G0 Z15.0 X{x_wait} Y{y_wait} F12000
  M107
  RESTORE_GCODE_STATE NAME=wipe_nozzle_state